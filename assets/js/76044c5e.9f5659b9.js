(self.webpackChunktp_spring_batch=self.webpackChunktp_spring_batch||[]).push([[8468],{62021:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return p},metadata:function(){return d},toc:function(){return m},default:function(){return c}});var n=a(87462),r=a(63366),i=(a(67294),a(3905)),o=a(93456),l=["components"],s={sidebar_position:2},p="DataSource",d={unversionedId:"tutorial-basics/datasource",id:"tutorial-basics/datasource",isDocsHomePage:!1,title:"DataSource",description:"Suite \xe0 la lecture des logs de traitement de votre premier batch, vous n'avez qu'une seule envie, c'est de comprendre le fonctionnement de cette DataSource et ces fameuses metadata.",source:"@site/docs/tutorial-basics/datasource.md",sourceDirName:"tutorial-basics",slug:"/tutorial-basics/datasource",permalink:"/docusaurus-test/docs/tutorial-basics/datasource",editUrl:"https://github.com/GoroGoraK/docusaurus-test/docs/tutorial-basics/datasource.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Mon premier Job",permalink:"/docusaurus-test/docs/tutorial-basics/first-job"},next:{title:"Param\xe8tres de Job",permalink:"/docusaurus-test/docs/tutorial-basics/jobparameter"}},m=[{value:"Objectif",id:"objectif",children:[{value:"Traitement cible",id:"traitement-cible",children:[]},{value:"Structure Physique",id:"structure-physique",children:[]}]},{value:"Pr\xe9ambule",id:"pr\xe9ambule",children:[]},{value:"Configuration par d\xe9faut de la datasource Spring",id:"configuration-par-d\xe9faut-de-la-datasource-spring",children:[{value:"D\xe9couverte de la console h2",id:"d\xe9couverte-de-la-console-h2",children:[]},{value:"D\xe9couverte des <em>Metadata</em> <em>Spring Batch</em>",id:"d\xe9couverte-des-metadata-spring-batch",children:[]},{value:"Cas d&#39;utilisation",id:"cas-dutilisation",children:[]}]},{value:"Configuration d&#39;une datasource",id:"configuration-dune-datasource",children:[{value:"Repr\xe9sentation",id:"repr\xe9sentation",children:[]},{value:"Configuration YAML",id:"configuration-yaml",children:[]},{value:"Configuration Java",id:"configuration-java",children:[]},{value:"Utilisation d&#39;une datasource dans la configuration",id:"utilisation-dune-datasource-dans-la-configuration",children:[]},{value:"Test de l&#39;application",id:"test-de-lapplication",children:[]},{value:"Alternative \xe0 la console H2",id:"alternative-\xe0-la-console-h2",children:[]},{value:"Cas d&#39;utilisation",id:"cas-dutilisation-1",children:[]}]},{value:"Configuration d&#39;une seconde datasource",id:"configuration-dune-seconde-datasource",children:[{value:"Configuration YAML",id:"configuration-yaml-1",children:[]},{value:"Configuration Java",id:"configuration-java-1",children:[]},{value:"Utilisation des datasources",id:"utilisation-des-datasources",children:[]},{value:"Test de l&#39;application",id:"test-de-lapplication-1",children:[]}]},{value:"Conclusion",id:"conclusion",children:[]}],u={toc:m};function c(e){var t=e.components,s=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,n.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"datasource"},"DataSource"),(0,i.kt)("p",null,"Suite \xe0 la lecture des ",(0,i.kt)("em",{parentName:"p"},"logs")," de traitement de votre premier batch, vous n'avez qu'une seule envie, c'est de comprendre le fonctionnement de cette ",(0,i.kt)("em",{parentName:"p"},"DataSource")," et ces fameuses ",(0,i.kt)("em",{parentName:"p"},"metadata")," \ud83d\ude01."),(0,i.kt)("p",null,"Vous \xeates au bon endroit \u263a\ufe0f."),(0,i.kt)("h2",{id:"objectif"},"Objectif"),(0,i.kt)("p",null,"L'objectif de cette partie sera de comprendre la configuration de ",(0,i.kt)("em",{parentName:"p"},"DataSource")," ",(0,i.kt)("em",{parentName:"p"},"Spring Batch")," via ",(0,i.kt)("em",{parentName:"p"},"Spring Boot")," et l'impact qu'\xe0 cette configuration sur le comportement de notre traitement."),(0,i.kt)("p",null,"Cette partie donnera des premiers \xe9l\xe9ments sur le mod\xe8le de donn\xe9es des metadatas utilis\xe9s par ",(0,i.kt)("em",{parentName:"p"},"Spring Batch"),"."),(0,i.kt)("h3",{id:"traitement-cible"},"Traitement cible"),(0,i.kt)("p",null,"Le traitement cible change l\xe9g\xe8rement pour l'insertion en base de donn\xe9es du contenu du fichier texte en entr\xe9e."),(0,i.kt)(o.Mermaid,{chart:"stateDiagram-v2\n  direction LR\n  Traitement: Spring Batch Context\n  [*] --\x3e myFirstJob : 1\n  state Traitement {\n    direction LR\n    JobTraitement:  Job Execution Context _\n      state JobTraitement {\n        direction LR\n        myFirstJob --\x3e myFirstStep : 2\n        StepExecutionContext : Step Execution Context\n        state StepExecutionContext {\n          myFirstStep --\x3e myFirstTasklet : 3\n                    note right of myFirstTasklet \n              Log le contenu d'un fichier \n              dans la console dans la console\n              <b>et ins\xe8re en base de donn\xe9es</b>\n          end note\n        }\n      }\n    }\n    myFirstJob --\x3e [*] : 4",mdxType:"Mermaid"}),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Lancement de notre ",(0,i.kt)("em",{parentName:"li"},"Job")," via ",(0,i.kt)("em",{parentName:"li"},"Launcher")," ou ",(0,i.kt)("em",{parentName:"li"},"Command Line"),"."),(0,i.kt)("li",{parentName:"ol"},"Lancement de notre ",(0,i.kt)("em",{parentName:"li"},"Step")," via notre ",(0,i.kt)("em",{parentName:"li"},"Job"),"."),(0,i.kt)("li",{parentName:"ol"},"Lancement de note ",(0,i.kt)("em",{parentName:"li"},"Tasklet")," via notre ",(0,i.kt)("em",{parentName:"li"},"Step"),".",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Log dans la console."),(0,i.kt)("li",{parentName:"ol"},"Insert dans la base de donn\xe9es."))),(0,i.kt)("li",{parentName:"ol"},"Fin de traitement.")),(0,i.kt)("h3",{id:"structure-physique"},"Structure Physique"),(0,i.kt)("p",null,"Voici la structure \xe0 atteindre lors de cette partie :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-{14,22}"},"\ud83d\udce6tutorial-spring-batch\n\u2523 \ud83d\udcc2src\n\u2503 \u2523 \ud83d\udcc2main\n\u2503 \u2503 \u2523 \ud83d\udcc2java\n\u2503 \u2503 \u2503 \u2517\ud83d\udd38fr.goro.tutorial.spring.batch\n\u2503 \u2503 \u2503   \u2503  \u2139\ufe0f Package racine du code source de l'application\n\u2503 \u2503 \u2503   \u2517\ud83d\udd38firstbatch\n\u2503 \u2503 \u2503     \u2503  \u2139\ufe0f Package racine de notre premier batch\n\u2503 \u2503 \u2503     \u2523\ud83d\udd38config\n\u2503 \u2503 \u2503     \u2503  \u2503  \u2139\ufe0f Package contenant la d\xe9finition des @Bean Spring, les classes \xe0 d\xe9velopper ici sont suffix\xe9es du mode Configuration (ou Config)\n\u2503 \u2503 \u2503     \u2503  \u2523\ud83d\udd38step\n\u2503 \u2503 \u2503     \u2503  \u2503  \u2503  \u2139\ufe0f Package contenant la d\xe9finition  des @Bean Step\n\u2503 \u2503 \u2503     \u2503  \u2503  \u2517 \ud83d\udcdcFirstTaskletStepConfiguration.java\n\u2503 \u2503 \u2503     \u2503  \u2523 \ud83d\udcdcDatasourceConfiguration.java\n\u2503 \u2503 \u2503     \u2503  \u2517 \ud83d\udcdcFirstBatchConfiguration.java\n\u2503 \u2503 \u2503     \u2523\ud83d\udd38tasklet\n\u2503 \u2503 \u2503     \u2503  \u2503  \u2139\ufe0f Package contenant la logique m\xe9tier des tasklets.\n\u2503 \u2503 \u2503     \u2503  \u2517 \ud83d\udcdcFirstTasklet.java\n\u2503 \u2503 \u2503     \u2517 \ud83d\udcdcTutorialSpringBatchApplication.java\n\u2503 \u2503 \u2517 \ud83d\udcc2resources\n\u2503 \u2503   \u2503  \u2139\ufe0f Resources de l'application\n\u2503 \u2503   \u2517 \ud83d\udcdc application.yml\n\u2503 \u2523 \ud83d\udcc2test\n\u2503 \u2503 \u2523 \ud83d\udcc2java\n\u2503 \u2503 \u2503  \u2139\ufe0f Code source des tests unitaires de l'application\n\u2503 \u2503 \u2517 \ud83d\udcc2resources\n\u2503 \u2503     \u2139\ufe0f Resources des tests unitaires (jeux de donn\xe9es,...)\n\u2503 \u2517 \ud83d\udcc2it\n\u2503   \u2523 \ud83d\udcc2java\n\u2503   \u2503   \u2139\ufe0f Code source des tests d'int\xe9gration\n\u2503   \u2517 \ud83d\udcc2resources\n\u2503       \u2139\ufe0f Resource des tests d'int\xe9gration (configuration Spring, ...)\n\u2517 \ud83d\udcdcpom.xml\n")),(0,i.kt)("h2",{id:"pr\xe9ambule"},"Pr\xe9ambule"),(0,i.kt)("p",null,"Pour de comprendre l'int\xe9r\xeat de cette ",(0,i.kt)("em",{parentName:"p"},"datasource"),", regardons le traitement cible un peu plus d\xe9taill\xe9 :"),(0,i.kt)(o.Mermaid,{chart:'flowchart TB\n  subgraph Traitement ["JVM"]\n    direction TB\n    subgraph TrtJava ["&nbsp;"]\n      TutorialSpringBatchApplication ==>|1| JobLauncher\n      subgraph SpringBatchContext ["Spring Batch Application Context"]\n        subgraph JobContext ["Job Application Context"]\n          Job -.- myFirstJob(myFirstJob)\n          Job ==>|2| StepContext\n          subgraph StepContext ["Step Application Context"]\n            direction TB\n            Step -.- myFirstStep(myFirstStep)\n            Step ==>|3| Tasklet\n            Tasklet -.- myFirstTasklet(myFirstTasklet)\n          end\n        end\n        JobLauncher <-.-> JobRepository\n        JobContext <-.-> JobRepository\n        StepContext <-.-> JobRepository\n      end\n    end\n    subgraph DataBase ["&nbsp;"]\n      direction BT\n      JobRepository <-.-> id3[(H2 - Embedded Database)]\n    end\n  end\n  JobLauncher --\x3e JobContext\n  Start["Lanchement de l\'application via Launcher ou Command Line"] --\x3e|0| Traitement --\x3e|4| End["Fin de traitement"]',mdxType:"Mermaid"}),(0,i.kt)("ol",{start:0},(0,i.kt)("li",{parentName:"ol"},"Lancement de notre application Spring."),(0,i.kt)("li",{parentName:"ol"},"Lancement de notre ",(0,i.kt)("em",{parentName:"li"},"Job")," au sein de son contexte via le ",(0,i.kt)("em",{parentName:"li"},"JobLauncher"),"."),(0,i.kt)("li",{parentName:"ol"},"Lancement de notre ",(0,i.kt)("em",{parentName:"li"},"Step")," au sein de son contexte via notre ",(0,i.kt)("em",{parentName:"li"},"Job"),"."),(0,i.kt)("li",{parentName:"ol"},"Lancement de note ",(0,i.kt)("em",{parentName:"li"},"Tasklet")," via notre ",(0,i.kt)("em",{parentName:"li"},"Step"),".",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Log dans la console."),(0,i.kt)("li",{parentName:"ol"},"Insert en base de donn\xe9es."))),(0,i.kt)("li",{parentName:"ol"},"Fin de traitement.")),(0,i.kt)("p",null,"Tentons maintenant d'aller voir ce qu'il se cache derri\xe8re cette base de donn\xe9es."),(0,i.kt)("h2",{id:"configuration-par-d\xe9faut-de-la-datasource-spring"},"Configuration par d\xe9faut de la datasource Spring"),(0,i.kt)("p",null,"Comme nous l'avons vu pr\xe9c\xe9demment, ",(0,i.kt)("em",{parentName:"p"},"Spring Batch")," utilise par d\xe9faut une base de donn\xe9es ",(0,i.kt)("em",{parentName:"p"},"H2")," en m\xe9moire."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Attention")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Nous allons utiliser la console de la base de donn\xe9es H2, elle nous donnera acc\xe8s \xe0 une console Web permettant d'acc\xe8der \xe0 nos donn\xe9es durant le ",(0,i.kt)("em",{parentName:"p"},"debug")," de nos traitements par exemple."),(0,i.kt)("p",{parentName:"div"},"Pour pouvoir l'utiliser, nous devons ajouter la d\xe9pendance suivante au pom :"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-web</artifactId>\n</dependency>\n")),(0,i.kt)("p",{parentName:"div"},"C'est elle qui lancera le conteneur Web n\xe9cessaire pour l'acc\xe8s \xe0 l'url de notre console ",(0,i.kt)("em",{parentName:"p"},"H2")," (http://localhost:8080/h2 ici en l'occurence)."),(0,i.kt)("p",{parentName:"div"},"Attention, n\xe9anmoins, en l'\xe9tat, nous l'embarquerons pour le build final, ce qui est inutile, elle peut etre ajout\xe9e \xe0 un profil ",(0,i.kt)("em",{parentName:"p"},"maven")," ",(0,i.kt)("em",{parentName:"p"},"dev")," ou utilis\xe9e uniquement en cas de besoin."))),(0,i.kt)("p",null,"Apr\xe8s l'ajout de la d\xe9pendance ",(0,i.kt)("em",{parentName:"p"},"spring-boot-starter-web"),", nous pouvons voir ceci dans les logs :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text",metastring:"{1,4,8}","{1,4,8}":!0},"o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)\no.apache.catalina.core.StandardService   : Starting service [Tomcat]\norg.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.52]\no.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext\nw.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 3124 ms\ncom.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...\ncom.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.\no.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:5576c7a2-3acb-4f63-bdac-40e738650027'\no.s.b.c.r.s.JobRepositoryFactoryBean     : No database type set, using meta data indicating: H2\no.s.b.c.l.support.SimpleJobLauncher      : No TaskExecutor has been set, defaulting to synchronous executor.\no.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''\n")),(0,i.kt)("p",null,"Une base de donn\xe9es a \xe9t\xe9 cr\xe9\xe9e : ",(0,i.kt)("inlineCode",{parentName:"p"},"jdbc:h2:mem:5576c7a2-3acb-4f63-bdac-40e738650027"),", une console est disponible sur un ",(0,i.kt)("em",{parentName:"p"},"context path")," vide d'un tomcat embarqu\xe9 (",(0,i.kt)("em",{parentName:"p"},"embedded WebApplicationContext"),") \xe0 l'url ",(0,i.kt)("inlineCode",{parentName:"p"},"/h2-console"),"."),(0,i.kt)("h3",{id:"d\xe9couverte-de-la-console-h2"},"D\xe9couverte de la console h2"),(0,i.kt)("p",null,"Avec la configuration pr\xe9c\xe9dente, voyons ce qu'il se passe si nous mettons un point d'arret lors du traitement (disons, au moment du ",(0,i.kt)("em",{parentName:"p"},"return")," de la m\xe9thode ",(0,i.kt)("em",{parentName:"p"},"execute")," de la premi\xe8re ",(0,i.kt)("em",{parentName:"p"},"Tasklet"),") et que nous relan\xe7ons le batch en mode ",(0,i.kt)("em",{parentName:"p"},"Debug"),"."),(0,i.kt)("p",null,"Rendons-nous \xe0 cette url : ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:8080/h2-console/%5D"},"http://localhost:8080/h2-console")," et nous nous retrouvons face \xe0 une console Web de connexion."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},(0,i.kt)("img",{alt:"h2-console",src:a(57239).Z})))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("b",null,"Console H2 configur\xe9 sur le path par d\xe9faut /h2-console - Login"))))),(0,i.kt)("p",null,"Suivons notre configuration, et utilisons le user ",(0,i.kt)("em",{parentName:"p"},"sa"),", avec un password vide (pensez \xe0 utiliser le bon nom de base de donn\xe9es issu des logs, dans l'exemple : ",(0,i.kt)("inlineCode",{parentName:"p"},"5576c7a2-3acb-4f63-bdac-40e738650027"),", dans l'image : ",(0,i.kt)("inlineCode",{parentName:"p"},"springMetadata"),")."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},(0,i.kt)("img",{alt:"h2-console",src:a(4385).Z})))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("b",null,"Console H2 Up"))))),(0,i.kt)("p",null,"Nous avons d\xe9sormais acc\xe8s \xe0 une console web permettant de consulter les informations techniques de notre batch."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Attention")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"La console ",(0,i.kt)("em",{parentName:"p"},"H2")," \xe9tant h\xe9berg\xe9e sur un ",(0,i.kt)("em",{parentName:"p"},"tomcat")," embarqu\xe9e par ",(0,i.kt)("em",{parentName:"p"},"Spring Boot"),", elle ne sera disponible que lors du traitement batch. C'est pour cela qu'il est n\xe9cessaire de mettre un point d'arr\xeat pour s'y arr\xeater."))),(0,i.kt)("h3",{id:"d\xe9couverte-des-metadata-spring-batch"},"D\xe9couverte des ",(0,i.kt)("em",{parentName:"h3"},"Metadata")," ",(0,i.kt)("em",{parentName:"h3"},"Spring Batch")),(0,i.kt)("p",null,"Voici un extrait ci-dessous qui nous permettra de naviguer dans ce mod\xe8le technique :"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},(0,i.kt)("img",{alt:"ERD-Metadata",src:a(44929).Z})))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"td"},"Image Credits - ",(0,i.kt)("a",{parentName:"strong",href:"https://docs.spring.io/spring-batch/docs/current/reference/html/index-single.html#metaDataSchema"},"Figure 35. Spring Batch Meta-Data ERD")))))),(0,i.kt)("h4",{id:"batch_job_instance"},"BATCH_JOB_INSTANCE"),(0,i.kt)("p",null,"Il s'agit de la table principale du mod\xe8le de donn\xe9es."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM BATCH_JOB_INSTANCE;\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"JOB_INSTANCE_ID"),(0,i.kt)("th",{parentName:"tr",align:null},"VERSION"),(0,i.kt)("th",{parentName:"tr",align:null},"JOB_NAME"),(0,i.kt)("th",{parentName:"tr",align:null},"JOB_KEY"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"myFirstJob"),(0,i.kt)("td",{parentName:"tr",align:null},"d41d8cd98f00b204e9800998ecf8427e")))),(0,i.kt)("p",null,"La table nous indique qu'un batch nomm\xe9 ",(0,i.kt)("em",{parentName:"p"},"myFirstJob")," tourne, ou a tourn\xe9."),(0,i.kt)("p",null,"Nous noterons son ",(0,i.kt)("em",{parentName:"p"},"JOB_INSTANCE_ID")," (1, il s'agit d'une base m\xe9moire, nous aurons toujours 1, n\xe9anmoins, si les metadata sont persit\xe9es, cet ",(0,i.kt)("em",{parentName:"p"},"id")," sera incr\xe9ment\xe9)."),(0,i.kt)("h4",{id:"batch_job_execution"},"BATCH_JOB_EXECUTION"),(0,i.kt)("p",null,"Il s'agit de la table contenant les informations d'ex\xe9cution de ",(0,i.kt)("em",{parentName:"p"},"Job"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM BATCH_JOB_EXECUTION;\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"JOB_EXECUTION_ID"),(0,i.kt)("th",{parentName:"tr",align:null},"VERSION"),(0,i.kt)("th",{parentName:"tr",align:null},"JOB_INSTANCE_ID"),(0,i.kt)("th",{parentName:"tr",align:null},"CREATE_TIME"),(0,i.kt)("th",{parentName:"tr",align:null},"START_TIME"),(0,i.kt)("th",{parentName:"tr",align:null},"END_TIME"),(0,i.kt)("th",{parentName:"tr",align:null},"STATUS"),(0,i.kt)("th",{parentName:"tr",align:null},"EXIT_CODE"),(0,i.kt)("th",{parentName:"tr",align:null},"EXIT_MESSAGE"),(0,i.kt)("th",{parentName:"tr",align:null},"LAST_UPDATED"),(0,i.kt)("th",{parentName:"tr",align:null},"JOB_CONFIGURATION_LOCATION"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"2021-09-13 19:03:14.702"),(0,i.kt)("td",{parentName:"tr",align:null},"2021-09-13"),(0,i.kt)("td",{parentName:"tr",align:null},"01:03:14.88"),(0,i.kt)("td",{parentName:"tr",align:null},"null"),(0,i.kt)("td",{parentName:"tr",align:null},"STARTED"),(0,i.kt)("td",{parentName:"tr",align:null},"UNKNOWN"),(0,i.kt)("td",{parentName:"tr",align:null},"2021-09-13 01:03:14.881"),(0,i.kt)("td",{parentName:"tr",align:null},"null")))),(0,i.kt)("p",null,"La table nous apprend que le ",(0,i.kt)("em",{parentName:"p"},"Job")," li\xe9 au ",(0,i.kt)("em",{parentName:"p"},"JOB_INSTANCE_ID")," 1 est en train de tourn\xe9, que son statut de fin d'ex\xe9cution est ind\xe9fini (",(0,i.kt)("em",{parentName:"p"},"STATUS")," = null && ",(0,i.kt)("em",{parentName:"p"},"EXIT_CODE")," = ",(0,i.kt)("em",{parentName:"p"},"UNKNWON"),", notre point d'arr\xeat \xe0 stopp\xe9 temporairement l'ex\xe9cution du ",(0,i.kt)("em",{parentName:"p"},"Job"),")."),(0,i.kt)("h4",{id:"batch_job_execution_params"},"BATCH_JOB_EXECUTION_PARAMS"),(0,i.kt)("p",null,"Il s'agit de la table contenant les param\xe8tres d'ex\xe9cution."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM BATCH_JOB_EXECUTION_PARAMS;\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"JOB_EXECUTION_ID"),(0,i.kt)("th",{parentName:"tr",align:null},"TYPE_CD"),(0,i.kt)("th",{parentName:"tr",align:null},"KEY_NAME"),(0,i.kt)("th",{parentName:"tr",align:null},"STRING_VAL"),(0,i.kt)("th",{parentName:"tr",align:null},"DATE_VAL"),(0,i.kt)("th",{parentName:"tr",align:null},"LONG_VAL"),(0,i.kt)("th",{parentName:"tr",align:null},"DOUBLE_VAL"),(0,i.kt)("th",{parentName:"tr",align:null},"IDENTIFYING")))),(0,i.kt)("p",null,"Il s'agit d'une table tr\xe8s importante, ",(0,i.kt)("em",{parentName:"p"},"Spring Batch")," s'appuiera dessus pour le rerun d'un batch d\xe9j\xe0 ex\xe9cut\xe9."),(0,i.kt)("p",null,"Le couple ",(0,i.kt)("em",{parentName:"p"},"KEY_NAME")," et ",(0,i.kt)("em",{parentName:"p"},"STRING_VAL")," fera office d'identifiant de batch si le boolean ",(0,i.kt)("em",{parentName:"p"},"IDENTIFYING")," est \xe0 true."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Nous verrons plus tard dans le tutoriel comment ajouter des param\xe8tres d'ex\xe9cution."))),(0,i.kt)("h4",{id:"batch_job_execution_context"},"BATCH_JOB_EXECUTION_CONTEXT"),(0,i.kt)("p",null,"Il s'agit de la table de contexte d'ex\xe9cution de Job."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM BATCH_JOB_EXECUTION_CONTEXT;\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"JOB_EXECUTION_ID"),(0,i.kt)("th",{parentName:"tr",align:null},"SHORT_CONTEXT"),(0,i.kt)("th",{parentName:"tr",align:null},"SERIALIZED_CONTEXT"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},'{"@class":"java.util.HashMap"}'),(0,i.kt)("td",{parentName:"tr",align:null},"null")))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Nous verrons plus tard dans le tutoriel comment ajouter des param\xe8tres d'ex\xe9cution."))),(0,i.kt)("h4",{id:"batch_step_execution"},"BATCH_STEP_EXECUTION"),(0,i.kt)("p",null,"L'ensemble des ",(0,i.kt)("em",{parentName:"p"},"Step")," lanc\xe9es par les jobs."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM BATCH_STEP_EXECUTION;\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"STEP_EXECUTION_ID"),(0,i.kt)("th",{parentName:"tr",align:null},"VERSION"),(0,i.kt)("th",{parentName:"tr",align:null},"STEP_NAME"),(0,i.kt)("th",{parentName:"tr",align:null},"JOB_EXECUTION_ID"),(0,i.kt)("th",{parentName:"tr",align:null},"START_TIME"),(0,i.kt)("th",{parentName:"tr",align:null},"END_TIME"),(0,i.kt)("th",{parentName:"tr",align:null},"STATUS"),(0,i.kt)("th",{parentName:"tr",align:null},"COMMIT_COUNT"),(0,i.kt)("th",{parentName:"tr",align:null},"READ_COUNT"),(0,i.kt)("th",{parentName:"tr",align:null},"FILTER_COUNT"),(0,i.kt)("th",{parentName:"tr",align:null},"WRITE_COUNT"),(0,i.kt)("th",{parentName:"tr",align:null},"READ_SKIP_COUNT"),(0,i.kt)("th",{parentName:"tr",align:null},"WRITE_SKIP_COUNT"),(0,i.kt)("th",{parentName:"tr",align:null},"PROCESS_SKIP_COUNT"),(0,i.kt)("th",{parentName:"tr",align:null},"ROLLBACK_COUNT"),(0,i.kt)("th",{parentName:"tr",align:null},"EXIT_CODE"),(0,i.kt)("th",{parentName:"tr",align:null},"EXIT_MESSAGE"),(0,i.kt)("th",{parentName:"tr",align:null},"LAST_UPDATED"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"myFirstStep"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"2021-09-13 19:03:14.926"),(0,i.kt)("td",{parentName:"tr",align:null},"null"),(0,i.kt)("td",{parentName:"tr",align:null},"STARTED"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"0"),(0,i.kt)("td",{parentName:"tr",align:null},"EXECUTING"),(0,i.kt)("td",{parentName:"tr",align:null},"2021-09-13 01:03:14.927"),(0,i.kt)("td",{parentName:"tr",align:null})))),(0,i.kt)("p",null,"La table nous indique qu'une ",(0,i.kt)("em",{parentName:"p"},"Step")," li\xe9 \xe0 notre ",(0,i.kt)("em",{parentName:"p"},"Job")," vu pr\xe9c\xe9dement (",(0,i.kt)("em",{parentName:"p"},"JOB_EXECUTION_ID")," = 1) nomm\xe9e ",(0,i.kt)("em",{parentName:"p"},"myFirstStep")," est en train de tourner (",(0,i.kt)("em",{parentName:"p"},"STATUS")," = ",(0,i.kt)("em",{parentName:"p"},"STARTED"),")"),(0,i.kt)("p",null,"Cette ",(0,i.kt)("em",{parentName:"p"},"Step")," n'a aucun compteur diff\xe9rent de 0."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Nous verrons plus tard dans le tutoriel comment utiliser les compteurs fournis par les ",(0,i.kt)("em",{parentName:"p"},"metadata")," de ",(0,i.kt)("em",{parentName:"p"},"Spring Batch"),"."))),(0,i.kt)("h4",{id:"batch_step_execution_context"},"BATCH_STEP_EXECUTION_CONTEXT"),(0,i.kt)("p",null,"Il s'agit de la table de context d'ex\xe9cution de ",(0,i.kt)("em",{parentName:"p"},"Step"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM BATCH_STEP_EXECUTION_CONTEXT;\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"STEP_EXECUTION_ID"),(0,i.kt)("th",{parentName:"tr",align:null},"SHORT_CONTEXT"),(0,i.kt)("th",{parentName:"tr",align:null},"SERIALIZED_CONTEXT"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},'{"@class":"java.util.HashMap","batch.taskletType":"fr.goro.tutorial.spring.batch.firstbatch.tasklet.FirstTasklet","batch.stepType":"org.springframework.batch.core.step.tasklet.TaskletStep"}'),(0,i.kt)("td",{parentName:"tr",align:null},"null")))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Nous verrons plus tard dans le tutoriel comment utiliser les compteurs fournis par les ",(0,i.kt)("em",{parentName:"p"},"metadata")," de ",(0,i.kt)("em",{parentName:"p"},"Spring Batch"),"."))),(0,i.kt)("h3",{id:"cas-dutilisation"},"Cas d'utilisation"),(0,i.kt)("p",null,"Ce cas d'utilisation est relativement rare, il ne s'utilise qu'en cas de non utilisation de base de donn\xe9es annexes (pour stockage, ou r\xe9cup\xe9ration de donn\xe9es durant le batch), et de non stockage (\xe0 minima pour historisation) des donn\xe9es relatives au ex\xe9cution de notre traitement."),(0,i.kt)("h2",{id:"configuration-dune-datasource"},"Configuration d'une datasource"),(0,i.kt)("h3",{id:"repr\xe9sentation"},"Repr\xe9sentation"),(0,i.kt)(o.Mermaid,{chart:'flowchart TB\n  subgraph Traitement ["JVM"]\n    direction LR\n    subgraph TrtJava ["&nbsp;"]\n      TutorialSpringBatchApplication ==>|1| JobLauncher\n      subgraph SpringBatchContext ["Spring Batch Application Context"]\n        subgraph JobContext ["Job Context"]\n          Job -.- myFirstJob(myFirstJob)\n          Job ==>|2| StepContext\n          subgraph StepContext ["Step Context"]\n            direction TB\n            Step -.- myFirstStep(myFirstStep)\n            Step ==>|3| Tasklet\n            Tasklet -.- myFirstTasklet(myFirstTasklet)\n          end\n        end\n        JobLauncher <-.-> JobRepository\n        JobContext <-.-> JobRepository\n        StepContext <-.-> JobRepository\n      end\n    end\n  end\n  JobLauncher --\x3e JobContext\n  Start["Lanchement de l\'application via Launcher ou Command Line"] --\x3e|0| Traitement --\x3e|4| End["Fin de traitement"]\n  subgraph DataBase ["&nbsp;"]\n    direction BT\n      id3[(H2 - File Database)]\n  end\n  JobRepository <-.-> id3\n  myFirstTasklet <-.-> id3',mdxType:"Mermaid"}),(0,i.kt)("p",null,"Contrairement \xe0 la configuration par d\xe9faut, ici, la base de donn\xe9es n'est plus en m\xe9moire."),(0,i.kt)("p",null,"Aussi, suite \xe0 notre modification de ",(0,i.kt)("em",{parentName:"p"},"tasklet"),", ",(0,i.kt)("em",{parentName:"p"},"myFirstTasklet")," acc\xe8de (pas tr\xe8s proprement ^^) \xe0 notre base de donn\xe9es."),(0,i.kt)("h3",{id:"configuration-yaml"},"Configuration YAML"),(0,i.kt)("p",null,"Commen\xe7ons par la configuration de la base de donn\xe9es sp\xe9cifique \xe0 ",(0,i.kt)("em",{parentName:"p"},"Spring Batch")," :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="application.yml"',title:'"application.yml"'},"spring:\n  datasource:\n    url: jdbc:h2:~/Documents/h2db/tutorialSpringBatchDb;INIT=CREATE TABLE IF NOT EXISTS info_traitement (message varchar)\n    driverClassName: org.h2.Driver\n    username: sa\n    password: \n  jpa:\n    database-platform: org.hibernate.dialect.H2Dialect\n  h2:\n    console:\n      enabled: true\ninputFile: file:/chemin/vers/fichier_a_traiter.txt\n")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Notre base de donn\xe9es aura pour url une base de donn\xe9es H2 qui pointe vers un fichier local, que nous avons nomm\xe9e springMetadata, le username par d\xe9faut est sa, aucun password."),(0,i.kt)("p",{parentName:"div"},"L'ensemble de la configuration apr\xe8s le ",(0,i.kt)("inlineCode",{parentName:"p"},"INIT")," sert \xe0 simuler la pr\xe9sence d'une info_traitement."),(0,i.kt)(o.Mermaid,{chart:"erDiagram\n    INFO_TRAITEMENT {\n        string message\n   }",mdxType:"Mermaid"}))),(0,i.kt)("h3",{id:"configuration-java"},"Configuration Java"),(0,i.kt)("p",null,"NA/ \ud83d\ude04"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Spring")," se charge de la configuration du ",(0,i.kt)("inlineCode",{parentName:"p"},"@Bean")," ",(0,i.kt)("em",{parentName:"p"},"datasource")," tout seul, seules les informations pr\xe9sentent dans la variable de configuration ",(0,i.kt)("inlineCode",{parentName:"p"},"spring.datasource")," du fichier ",(0,i.kt)("inlineCode",{parentName:"p"},"application.yml")," seront n\xe9cessaires."),(0,i.kt)("p",null,"N\xe9anmoins, nous allons modifier notre ",(0,i.kt)("em",{parentName:"p"},"tasklet")," pour lui faire \xe9crire en base, alors pr\xe9parons, le terrain :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},'    /**\n     * D\xe9finition de notre premi\xe8re {@link Tasklet} de lecture de fichier.\n     * \n     * @param directoryPath la {@link Resource} dont le path est issu du fichier de\n     *                      configuration.\n     * @param datasource    la datasource utilis\xe9e.\n     * @return notre premi\xe8re {@link Tasklet} configur\xe9e.\n     */\n    @Bean\n    public Tasklet myFirstTasklet(@Value("${inputFile}") final Resource directoryPath,\n            final DataSource datasource) {\n        return new FirstTasklet(directoryPath, datasource);\n    }\n')),(0,i.kt)("h3",{id:"utilisation-dune-datasource-dans-la-configuration"},"Utilisation d'une datasource dans la configuration"),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Attention")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Ce code source n'est qu'un exemple le plus simple pour visualiser en base de donn\xe9es le r\xe9sultat, il ne fait pas office de bon exemple."))),(0,i.kt)("p",null,"Nous allons simplement ajouter un attribut ",(0,i.kt)("em",{parentName:"p"},"DataSource")," et ins\xe9rer notre contenu dans la base de donn\xe9es :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"{7-10,16,18,21,27-28,37-43}","{7-10,16,18,21,27-28,37-43}":!0},'...\n    /**\n     * Le fichier \xe0 traiter.\n     */\n    private final Resource inputFile;\n\n    /**\n     * Datasource de traitement.\n     */\n    private final DataSource datasource;\n\n    /**\n     * Constructeur param\xe9tr\xe9 de MyFirstTasklet.\n     *\n     * @param inputFile  le fichier \xe0 traiter.\n     * @param datasource la datasource de traitement.\n     */\n    public FirstTasklet(final Resource inputFile, final DataSource datasource) {\n        Assert.notNull(inputFile, "Le fichier en entr\xe9e de la Tasklet ne peut \xeatre vide !");\n        this.inputFile = inputFile;\n        this.datasource = datasource;\n    }\n\n    /**\n     * M\xe9thode de traitement de {@link FirstTasklet}.\n     *\n     * Cette m\xe9thode logguera puis stockera en base de donn\xe9es le contenu du fichier\n     * pass\xe9 en param\xe9tre.\n     *\n     */\n    @Override\n    public RepeatStatus execute(final StepContribution contribution, final ChunkContext chunkContext) throws Exception {\n        final String message = Files.lines(inputFile.getFile().toPath()).collect(Collectors.joining("\\n"));\n    \n        LOGGER.info(message);\n    \n        // Insertion en base de donn\xe9es.\n        final PreparedStatement prepareStatement = datasource.getConnection()\n            .prepareStatement("insert into info_traitement (message) values (?)");\n        prepareStatement.setString(1, message);\n        prepareStatement.executeUpdate();\n    \n        return RepeatStatus.FINISHED;\n    }\n')),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Rappel \ud83d\ude04 Best Practice")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Ne jamais utiliser d'annotation dans une classe de traitement. Pour un batch ",(0,i.kt)("em",{parentName:"p"},"Spring"),", les annotations ne seront accept\xe9es que dans la main class ou dans le package ",(0,i.kt)("inlineCode",{parentName:"p"},"config"),"."))),(0,i.kt)("h3",{id:"test-de-lapplication"},"Test de l'application"),(0,i.kt)("p",null,"Avec cette configuration, si nous lan\xe7ons notre batch, nous retrouvons ces informations dans les logs :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext\nw.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 2791 ms\ncom.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...\ncom.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.\no.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:~/Documents/h2db/tutorialSpringBatchDb'\no.s.b.c.r.s.JobRepositoryFactoryBean     : No database type set, using meta data indicating: H2\no.s.b.c.l.support.SimpleJobLauncher      : No TaskExecutor has been set, defaulting to synchronous executor.\no.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''\n")),(0,i.kt)("p",null,"Remettons un point d'arr\xeat dans la ",(0,i.kt)("em",{parentName:"p"},"Tasklet")," et relan\xe7ons en mode ",(0,i.kt)("em",{parentName:"p"},"Debug"),"."),(0,i.kt)("p",null,"Oh ! Oh Oh Oh Oh ! \u26ab"),(0,i.kt)("p",null,"L'iDE ne s'est pas arr\xe9t\xe9 dans le point d'arr\xeat, regardons les logs..."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"o.s.b.a.b.JobLauncherApplicationRunner   : Running default command line with: [CommandLineJobRunner, fr.goro.tutorial.spring.batch.firstbatch.config.FirstBatchConfiguration, myFirstJob]\no.s.b.c.l.support.SimpleJobLauncher      : Job: [SimpleJob: [name=myFirstJob]] launched with the following parameters: [{}]\no.s.batch.core.job.SimpleStepHandler     : Step already complete or not restartable, so no action to execute: StepExecution: id=2, version=3, name=myFirstStep, status=COMPLETED, exitStatus=COMPLETED, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=1, rollbackCount=0, exitDescription=\no.s.b.c.l.support.SimpleJobLauncher      : Job: [SimpleJob: [name=myFirstJob]] completed with the following parameters: [{}] and the following status: [COMPLETED] in 52ms\n")),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Attention")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Un ",(0,i.kt)("em",{parentName:"p"},"Job")," lanc\xe9 avec les m\xeames param\xe8tres (ici, aucun param\xe8tre) ne peut \xeatre relanc\xe9 que s'il n'est pas \xe0 l'\xe9tat ",(0,i.kt)("em",{parentName:"p"},"COMPLETED")," (notamment pour pouvoir relancer un batch ",(0,i.kt)("em",{parentName:"p"},"FAILED")," apr\xe8s correction des entrants par exemple)."),(0,i.kt)("p",{parentName:"div"},"Il est possible de le faire sur une base de donn\xe9es embarqu\xe9e en m\xe9moire car celle-ci est recr\xe9\xe9e \xe0 chaque lancement du batch."))),(0,i.kt)("p",null,"Ici, nous travaillons sur une base de donn\xe9es en local, vous pouvez supprimer le fichier ",(0,i.kt)("em",{parentName:"p"},"db")," cr\xe9\xe9 au chemin d\xe9fini dans l'",(0,i.kt)("inlineCode",{parentName:"p"},"application.yml"),"."),(0,i.kt)("p",null,"Pour parer ce comportement, et puisque nous ne nous interesserons pas \xe0 au re-run dans cette partie du tutoriel, nous allons modifier le lancement de notre batch :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'{5} title="Extrait de fr.goro.tutorial.spring.batch.firstbatch.config.FirstBatchConfiguration.java"',"{5}":!0,title:'"Extrait',de:!0,'fr.goro.tutorial.spring.batch.firstbatch.config.FirstBatchConfiguration.java"':!0},'...\n@Bean\npublic Job myFirstJob(final JobBuilderFactory jobBuilderFactory, final Step myFirstStep) {\n    return jobBuilderFactory.get("myFirstJob")\n        .incrementer(new RunIdIncrementer())\n        .start(myFirstStep)\n        .build();\n}\n...\n')),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Nous utilisons ici un incr\xe9menteur d'identifiant de metadata, ce qui nous permettra de relancer le batch avec les m\xeames param\xe8tres."))),(0,i.kt)("p",null,"Vous pouvez d\xe9sormais supprimer vos point d'arr\xeat et relancer le batch autant de fois que vous voulez, il cr\xe9\xe9ra autant d'instance de ",(0,i.kt)("em",{parentName:"p"},"Job")," en base de donn\xe9es."),(0,i.kt)("h3",{id:"alternative-\xe0-la-console-h2"},"Alternative \xe0 la console H2"),(0,i.kt)("p",null,"D\xe9sormais, nous avons un fichier ",(0,i.kt)("em",{parentName:"p"},"db")," qui stocke notre base de donn\xe9es H2, il est facile de param\xe9trer une vue pour acc\xe8der graphiquement aux donn\xe9es."),(0,i.kt)("h4",{id:"la-vue-database-development"},"La vue Database Development"),(0,i.kt)("p",null,"Cette vue est disponible sur ",(0,i.kt)("em",{parentName:"p"},"Eclipse EE 2021-06"),", elle peut \xeatre install\xe9e via le MarketPlace sur d'autres versions : ",(0,i.kt)("inlineCode",{parentName:"p"},"Database Tools Platform (DTP) Plugin"),". "),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"th"},(0,i.kt)("img",{alt:"DbeaverData",src:a(47098).Z}))))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"td"},"Database Tools Plateform - Configuration"))))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"th"},(0,i.kt)("img",{alt:"DbeaverData",src:a(65506).Z}))))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"td"},"Database Tools Plateform - View Data"))))),(0,i.kt)("h4",{id:"la-vue-dbeaver"},"La vue DBEaver"),(0,i.kt)("p",null,"DbEaver est un plugin disponible sur le MarketPlace."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"th"},(0,i.kt)("img",{alt:"DbeaverData",src:a(99094).Z}))))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"td"},"DbEaver - Configuration"))))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"th"},(0,i.kt)("img",{alt:"DbeaverData",src:a(15336).Z}))))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"td"},"DbEaver - View Data"))))),(0,i.kt)("p",null,"Des deux, DBEaver est le seul \xe0 proposer un ex\xe9cuteur de requ\xeate, ce qui peut \xeatre tr\xe8s utile."),(0,i.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Lorsque vous vous connectez \xe0 la base de donn\xe9es via l'un de ces deux plugins, vous verrouillez la base de donn\xe9es. Pensez \xe0 syst\xe9matiquement couper la connexion apr\xe8s avoir analys\xe9 les donn\xe9es."))),(0,i.kt)("h3",{id:"cas-dutilisation-1"},"Cas d'utilisation"),(0,i.kt)("p",null,"Ce cas d'utilisation est, selon moi, un cas standard lorsque "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"l'on n'acc\xe8de \xe0 aucune autre base de donn\xe9es ",(0,i.kt)("strong",{parentName:"li"},"OU")),(0,i.kt)("li",{parentName:"ul"},"l'on peut stocker les metadatas sur le sch\xe8ma par d\xe9faut (g\xe9n\xe9ralement ",(0,i.kt)("em",{parentName:"li"},"public"),") de la base de donn\xe9es utilis\xe9es pour nos traitements.")),(0,i.kt)("p",null,"Dans le cas contraire (une base de donn\xe9es est utilis\xe9e, mais on ne peut pas y stocker nos metadata), il est possible de configurer d'autres datasource."),(0,i.kt)("h2",{id:"configuration-dune-seconde-datasource"},"Configuration d'une seconde datasource"),(0,i.kt)("h3",{id:"configuration-yaml-1"},"Configuration YAML"),(0,i.kt)("p",null,"Nous allons modifier l'",(0,i.kt)("inlineCode",{parentName:"p"},"application.yml")," comme ci-dessous :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'{12-17} title="application.yml',"{12-17}":!0,title:'"application.yml'},"spring:\n  batch: \n    jdbc:\n      initialize-schema: always\n  datasource:\n    jdbcUrl: jdbc:h2:~/Documents/h2db/tutorialSpringBatchMetadataDb\n    driver-class-name: org.h2.Driver\n    username: sa\n    password:\n  datasourceTraitement:  \n    jdbcUrl: jdbc:h2:~/Documents/h2db/tutorialSpringBatchTraitementDb;INIT=CREATE TABLE IF NOT EXISTS info_traitement (message varchar)\n    driver-class-name: org.h2.Driver\n    username: sa\n    password: \ninputFile: file:~/Documents/test_tuto_batch/fichier_a_traiter.txt\n")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"La propri\xe9t\xe9 ",(0,i.kt)("em",{parentName:"p"},"datasourceTraitement")," est un nom d\xe9fini arbitrairement, essayer d'\xeatre coh\xe9rent et parlant lors du nommage de celle-ci."))),(0,i.kt)("h3",{id:"configuration-java-1"},"Configuration Java"),(0,i.kt)("p",null,"La configuration d'une datasource via ",(0,i.kt)("em",{parentName:"p"},"Spring Boot")," est grandement simplifi\xe9e, ainsi, voici la d\xe9finition de nos deux datasources :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},'package fr.goro.tutorial.spring.batch.firstbatch.config;\n\nimport javax.sql.DataSource;\n\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.boot.jdbc.DataSourceBuilder;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Primary;\n\n/**\n * Classe de configuration des datasources.\n * \n */\n@Configuration\n@EnableConfigurationProperties\npublic class DatasourcesConfiguration {\n\n    /**\n     * Cr\xe9ation de la datasource principale pour les metadata de Spring Batch.\n     * \n     * @return la datasource principale.\n     */\n    @Bean\n    @Primary\n    @ConfigurationProperties(prefix="spring.datasource")\n    public DataSource datasource() {\n        return DataSourceBuilder.create().build();\n    }\n    \n    /**\n     * Cr\xe9ation de la seconde datasource pour les donn\xe9es de traitement.\n     * \n     * @return la datasource secondaire.\n     */\n    @Bean\n    @ConfigurationProperties(prefix="spring.datasource-traitement")\n    public DataSource secondDatasource() {\n        return DataSourceBuilder.create().build();\n    }\n\n}\n')),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Il est important de pr\xe9ciser \xe0 ",(0,i.kt)("em",{parentName:"p"},"Spring Batch")," une ",(0,i.kt)("inlineCode",{parentName:"p"},"@Primary")," ",(0,i.kt)("em",{parentName:"p"},"datasource"),", c'est celle qui sera utilis\xe9 pour la cr\xe9ation des metadata.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Lors de l'utilisation de ",(0,i.kt)("em",{parentName:"p"},"@ConfigurationProperties")," (activ\xe9e par ",(0,i.kt)("em",{parentName:"p"},"@EnableConfigurationProperties"),"), il est recommand\xe9 d'ajouter cette d\xe9pendance au pom :"))),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-configuration-processor</artifactId>\n    <optional>true</optional>\n</dependency>\n")))),(0,i.kt)("h3",{id:"utilisation-des-datasources"},"Utilisation des datasources"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},'    /**\n     * D\xe9finition de notre premi\xe8re {@link Tasklet} de lecture de fichier.\n     * \n     * @param directoryPath la {@link Resource} dont le path est issu du fichier de\n     *                      configuration.\n     * @param secondDatasource    la datasource utilis\xe9e.\n     * @return notre premi\xe8re {@link Tasklet} configur\xe9e.\n     */\n    @Bean\n    public Tasklet myFirstTasklet(@Value("${inputFile}") final Resource directoryPath,\n            @Qualifier("secondDatasource") final DataSource secondDatasource) {\n        return new FirstTasklet(directoryPath, secondDatasource);\n    }\n')),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Il est, \xe0 priori, indispensable d'utiliser un ",(0,i.kt)("inlineCode",{parentName:"p"},"@Qualifier")," lorsqu'on utilise plusieurs datasources."))),(0,i.kt)("h3",{id:"test-de-lapplication-1"},"Test de l'application"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"th"},(0,i.kt)("img",{alt:"DbeaverData",src:a(37683).Z}))))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("strong",{parentName:"td"},"DbEaver - View Data - Twice Datasources"))))),(0,i.kt)("p",null,"Nous avons bien nos deux ",(0,i.kt)("em",{parentName:"p"},"datasources")," attendues :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"tutorialSpringBatchMetadataDb contenant les ",(0,i.kt)("em",{parentName:"li"},"metadata")," de ",(0,i.kt)("em",{parentName:"li"},"Spring Batch"),","),(0,i.kt)("li",{parentName:"ul"},"tutorialSpringBatchTraitementDb contenant les donn\xe9es m\xe9tiers de notre traitement.")),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"Nous venons de voir qu'il est assez simple de configurer des bases de donn\xe9es avec l'auto configuration de ",(0,i.kt)("em",{parentName:"p"},"Spring"),",\nn\xe9anmoins, nous avons \xe9t\xe9 incapable de relancer notre batch sans ",(0,i.kt)("inlineCode",{parentName:"p"},"IncrementerId"),"."),(0,i.kt)("p",null,"Afin de mieux comprendre ce point, nous allons nous pencher sur la table BATCH",(0,i.kt)("em",{parentName:"p"},"JOB_PARAMETERS, et l'utilisation de param\xe8tre pass\xe9 au _Job"),"."))}c.isMDXComponent=!0},11748:function(e,t,a){var n={"./locale":89234,"./locale.js":89234};function r(e){var t=i(e);return a(t)}function i(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id=11748},44929:function(e,t,a){"use strict";t.Z=a.p+"assets/images/ERD_metadata-5163332f70087a920c422fd97befe87f.png"},99094:function(e,t,a){"use strict";t.Z=a.p+"assets/images/dbeaver_config-26313623055d6caecc48affdf57630e1.png"},15336:function(e,t,a){"use strict";t.Z=a.p+"assets/images/dbeaver_viewdata-eb65ef5cbd28457e68610fdb70793f11.png"},47098:function(e,t,a){"use strict";t.Z=a.p+"assets/images/dtp_config-2efe79ac198aa39ecbc88e7ddf24c26a.png"},65506:function(e,t,a){"use strict";t.Z=a.p+"assets/images/dtp_viewdata-965af5f2fddd7057301a2eed2435cc15.png"},4385:function(e,t,a){"use strict";t.Z=a.p+"assets/images/h2_admin-64cd47be0f2c0e24a12612a1fd8274fe.png"},57239:function(e,t,a){"use strict";t.Z=a.p+"assets/images/h2_console-3f7b0d4f27ef6b1ff25f0c601083a37f.png"},37683:function(e,t,a){"use strict";t.Z=a.p+"assets/images/h2_double_datasource-0d74bd8f0ac3e62db2d2419b0a178f06.png"}}]);