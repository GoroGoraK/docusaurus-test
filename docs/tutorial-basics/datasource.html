<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="alternate" type="application/rss+xml" href="/docusaurus-test/blog/rss.xml" title="Tp Spring Batch Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docusaurus-test/blog/atom.xml" title="Tp Spring Batch Blog Atom Feed"><title data-react-helmet="true">DataSource | Tp Spring Batch</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://github.com/docusaurus-test/docs/tutorial-basics/datasource"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="DataSource | Tp Spring Batch"><meta data-react-helmet="true" name="description" content="Suite √† la lecture des logs de traitement de votre premier batch, vous n&#x27;avez qu&#x27;une seule envie, c&#x27;est de comprendre le fonctionnement de cette DataSource et ces fameuses metadata."><meta data-react-helmet="true" property="og:description" content="Suite √† la lecture des logs de traitement de votre premier batch, vous n&#x27;avez qu&#x27;une seule envie, c&#x27;est de comprendre le fonctionnement de cette DataSource et ces fameuses metadata."><link data-react-helmet="true" rel="shortcut icon" href="/docusaurus-test/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/docusaurus-test/docs/tutorial-basics/datasource"><link data-react-helmet="true" rel="alternate" href="https://github.com/docusaurus-test/docs/tutorial-basics/datasource" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/docusaurus-test/docs/tutorial-basics/datasource" hreflang="x-default"><link rel="stylesheet" href="/docusaurus-test/assets/css/styles.cd5857e6.css">
<link rel="preload" href="/docusaurus-test/assets/js/runtime~main.08455da9.js" as="script">
<link rel="preload" href="/docusaurus-test/assets/js/main.416363ce.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus-test/"><img src="/docusaurus-test/img/spring.jpeg" alt="Spring Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docusaurus-test/img/spring.jpeg" alt="Spring Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Tp Spring Batch</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docusaurus-test/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/GoroGoraK/docusaurus-test" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docusaurus-test/docs/intro">Tutorial Intro</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial - Initialisation</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Tutorial - Premier Batch</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-test/docs/tutorial-basics/first-job">Mon premier Job</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus-test/docs/tutorial-basics/datasource">DataSource</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-test/docs/tutorial-basics/jobparameter">Param√®tres de Job</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-test/docs/tutorial-basics/first-test">Mes premiers tests automatis√©s</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial - Traitement par Lot</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial - Flow Conditionnel</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial - Tips</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>DataSource</h1></header><p>Suite √† la lecture des <em>logs</em> de traitement de votre premier batch, vous n&#x27;avez qu&#x27;une seule envie, c&#x27;est de comprendre le fonctionnement de cette <em>DataSource</em> et ces fameuses <em>metadata</em> üòÅ.</p><p>Vous √™tes au bon endroit ‚ò∫Ô∏è.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="objectif"></a>Objectif<a class="hash-link" href="#objectif" title="Direct link to heading">#</a></h2><p>L&#x27;objectif de cette partie sera de comprendre la configuration de <em>DataSource</em> <em>Spring Batch</em> via <em>Spring Boot</em> et l&#x27;impact qu&#x27;√† cette configuration sur le comportement de notre traitement.</p><p>Cette partie donnera des premiers √©l√©ments sur le mod√®le de donn√©es des metadatas utilis√©s par <em>Spring Batch</em>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="traitement-cible"></a>Traitement cible<a class="hash-link" href="#traitement-cible" title="Direct link to heading">#</a></h3><p>Le traitement cible change l√©g√®rement pour l&#x27;insertion en base de donn√©es du contenu du fichier texte en entr√©e.</p><div class="mermaid">stateDiagram-v2
  direction LR
  Traitement: Spring Batch Context
  [*] --&gt; myFirstJob : 1
  state Traitement {
    direction LR
    JobTraitement:  Job Execution Context _
      state JobTraitement {
        direction LR
        myFirstJob --&gt; myFirstStep : 2
        StepExecutionContext : Step Execution Context
        state StepExecutionContext {
          myFirstStep --&gt; myFirstTasklet : 3
                    note right of myFirstTasklet 
              Log le contenu d&#x27;un fichier 
              dans la console dans la console
              &lt;b&gt;et ins√®re en base de donn√©es&lt;/b&gt;
          end note
        }
      }
    }
    myFirstJob --&gt; [*] : 4</div><ol><li>Lancement de notre <em>Job</em> via <em>Launcher</em> ou <em>Command Line</em>.</li><li>Lancement de notre <em>Step</em> via notre <em>Job</em>.</li><li>Lancement de note <em>Tasklet</em> via notre <em>Step</em>.<ol><li>Log dans la console.</li><li>Insert dans la base de donn√©es.</li></ol></li><li>Fin de traitement.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="structure-physique"></a>Structure Physique<a class="hash-link" href="#structure-physique" title="Direct link to heading">#</a></h3><p>Voici la structure √† atteindre lors de cette partie :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly {14,22}"><pre tabindex="0" class="prism-code language-{14,22} codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">üì¶tutorial-spring-batch</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚î£ üìÇsrc</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚î£ üìÇmain</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚î£ üìÇjava</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ ‚îóüî∏fr.goro.tutorial.spring.batch</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ   ‚îÉ  ‚ÑπÔ∏è Package racine du code source de l&#x27;application</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ   ‚îóüî∏firstbatch</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚ÑπÔ∏è Package racine de notre premier batch</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚î£üî∏config</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚îÉ  ‚ÑπÔ∏è Package contenant la d√©finition des @Bean Spring, les classes √† d√©velopper ici sont suffix√©es du mode Configuration (ou Config)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚î£üî∏step</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚îÉ  ‚îÉ  ‚ÑπÔ∏è Package contenant la d√©finition  des @Bean Step</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚îÉ  ‚îó üìúFirstTaskletStepConfiguration.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚î£ üìúDatasourceConfiguration.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚îó üìúFirstBatchConfiguration.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚î£üî∏tasklet</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚îÉ  ‚ÑπÔ∏è Package contenant la logique m√©tier des tasklets.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îÉ  ‚îó üìúFirstTasklet.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ     ‚îó üìúTutorialSpringBatchApplication.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îó üìÇresources</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ   ‚îÉ  ‚ÑπÔ∏è Resources de l&#x27;application</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ   ‚îó üìú application.yml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚î£ üìÇtest</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚î£ üìÇjava</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îÉ  ‚ÑπÔ∏è Code source des tests unitaires de l&#x27;application</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ ‚îó üìÇresources</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îÉ     ‚ÑπÔ∏è Resources des tests unitaires (jeux de donn√©es,...)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ ‚îó üìÇit</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ   ‚î£ üìÇjava</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ   ‚îÉ   ‚ÑπÔ∏è Code source des tests d&#x27;int√©gration</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ   ‚îó üìÇresources</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îÉ       ‚ÑπÔ∏è Resource des tests d&#x27;int√©gration (configuration Spring, ...)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">‚îó üìúpom.xml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="pr√©ambule"></a>Pr√©ambule<a class="hash-link" href="#pr√©ambule" title="Direct link to heading">#</a></h2><p>Pour de comprendre l&#x27;int√©r√™t de cette <em>datasource</em>, regardons le traitement cible un peu plus d√©taill√© :</p><div class="mermaid">flowchart TB
  subgraph Traitement [&quot;JVM&quot;]
    direction TB
    subgraph TrtJava [&quot;&amp;nbsp;&quot;]
      TutorialSpringBatchApplication ==&gt;|1| JobLauncher
      subgraph SpringBatchContext [&quot;Spring Batch Application Context&quot;]
        subgraph JobContext [&quot;Job Application Context&quot;]
          Job -.- myFirstJob(myFirstJob)
          Job ==&gt;|2| StepContext
          subgraph StepContext [&quot;Step Application Context&quot;]
            direction TB
            Step -.- myFirstStep(myFirstStep)
            Step ==&gt;|3| Tasklet
            Tasklet -.- myFirstTasklet(myFirstTasklet)
          end
        end
        JobLauncher &lt;-.-&gt; JobRepository
        JobContext &lt;-.-&gt; JobRepository
        StepContext &lt;-.-&gt; JobRepository
      end
    end
    subgraph DataBase [&quot;&amp;nbsp;&quot;]
      direction BT
      JobRepository &lt;-.-&gt; id3[(H2 - Embedded Database)]
    end
  end
  JobLauncher --&gt; JobContext
  Start[&quot;Lanchement de l&#x27;application via Launcher ou Command Line&quot;] --&gt;|0| Traitement --&gt;|4| End[&quot;Fin de traitement&quot;]</div><ol start="0"><li>Lancement de notre application Spring.</li><li>Lancement de notre <em>Job</em> au sein de son contexte via le <em>JobLauncher</em>.</li><li>Lancement de notre <em>Step</em> au sein de son contexte via notre <em>Job</em>.</li><li>Lancement de note <em>Tasklet</em> via notre <em>Step</em>.<ol><li>Log dans la console.</li><li>Insert en base de donn√©es.</li></ol></li><li>Fin de traitement.</li></ol><p>Tentons maintenant d&#x27;aller voir ce qu&#x27;il se cache derri√®re cette base de donn√©es.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration-par-d√©faut-de-la-datasource-spring"></a>Configuration par d√©faut de la datasource Spring<a class="hash-link" href="#configuration-par-d√©faut-de-la-datasource-spring" title="Direct link to heading">#</a></h2><p>Comme nous l&#x27;avons vu pr√©c√©demment, <em>Spring Batch</em> utilise par d√©faut une base de donn√©es <em>H2</em> en m√©moire.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Attention</h5></div><div class="admonition-content"><p>Nous allons utiliser la console de la base de donn√©es H2, elle nous donnera acc√®s √† une console Web permettant d&#x27;acc√®der √† nos donn√©es durant le <em>debug</em> de nos traitements par exemple.</p><p>Pour pouvoir l&#x27;utiliser, nous devons ajouter la d√©pendance suivante au pom :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>C&#x27;est elle qui lancera le conteneur Web n√©cessaire pour l&#x27;acc√®s √† l&#x27;url de notre console <em>H2</em> (http://localhost:8080/h2 ici en l&#x27;occurence).</p><p>Attention, n√©anmoins, en l&#x27;√©tat, nous l&#x27;embarquerons pour le build final, ce qui est inutile, elle peut etre ajout√©e √† un profil <em>maven</em> <em>dev</em> ou utilis√©e uniquement en cas de besoin.</p></div></div><p>Apr√®s l&#x27;ajout de la d√©pendance <em>spring-boot-starter-web</em>, nous pouvons voir ceci dans les logs :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.52]</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span></span><span class="token-line" style="color:#393A34"><span class="token plain">w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 3124 ms</span></span><span class="token-line" style="color:#393A34"><span class="token plain">com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at &#x27;/h2-console&#x27;. Database available at &#x27;jdbc:h2:mem:5576c7a2-3acb-4f63-bdac-40e738650027&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.c.r.s.JobRepositoryFactoryBean     : No database type set, using meta data indicating: H2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.c.l.support.SimpleJobLauncher      : No TaskExecutor has been set, defaulting to synchronous executor.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#x27;&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Une base de donn√©es a √©t√© cr√©√©e : <code>jdbc:h2:mem:5576c7a2-3acb-4f63-bdac-40e738650027</code>, une console est disponible sur un <em>context path</em> vide d&#x27;un tomcat embarqu√© (<em>embedded WebApplicationContext</em>) √† l&#x27;url <code>/h2-console</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="d√©couverte-de-la-console-h2"></a>D√©couverte de la console h2<a class="hash-link" href="#d√©couverte-de-la-console-h2" title="Direct link to heading">#</a></h3><p>Avec la configuration pr√©c√©dente, voyons ce qu&#x27;il se passe si nous mettons un point d&#x27;arret lors du traitement (disons, au moment du <em>return</em> de la m√©thode <em>execute</em> de la premi√®re <em>Tasklet</em>) et que nous relan√ßons le batch en mode <em>Debug</em>.</p><p>Rendons-nous √† cette url : <a href="http://localhost:8080/h2-console/%5D" target="_blank" rel="noopener noreferrer">http://localhost:8080/h2-console</a> et nous nous retrouvons face √† une console Web de connexion.</p><table><thead><tr><th align="center"><img alt="h2-console" src="/docusaurus-test/assets/images/h2_console-3f7b0d4f27ef6b1ff25f0c601083a37f.png"></th></tr></thead><tbody><tr><td align="center"><b>Console H2 configur√© sur le path par d√©faut /h2-console - Login</b></td></tr></tbody></table><p>Suivons notre configuration, et utilisons le user <em>sa</em>, avec un password vide (pensez √† utiliser le bon nom de base de donn√©es issu des logs, dans l&#x27;exemple : <code>5576c7a2-3acb-4f63-bdac-40e738650027</code>, dans l&#x27;image : <code>springMetadata</code>).</p><table><thead><tr><th align="center"><img alt="h2-console" src="/docusaurus-test/assets/images/h2_admin-64cd47be0f2c0e24a12612a1fd8274fe.png"></th></tr></thead><tbody><tr><td align="center"><b>Console H2 Up</b></td></tr></tbody></table><p>Nous avons d√©sormais acc√®s √† une console web permettant de consulter les informations techniques de notre batch.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Attention</h5></div><div class="admonition-content"><p>La console <em>H2</em> √©tant h√©berg√©e sur un <em>tomcat</em> embarqu√©e par <em>Spring Boot</em>, elle ne sera disponible que lors du traitement batch. C&#x27;est pour cela qu&#x27;il est n√©cessaire de mettre un point d&#x27;arr√™t pour s&#x27;y arr√™ter.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="d√©couverte-des-metadata-spring-batch"></a>D√©couverte des <em>Metadata</em> <em>Spring Batch</em><a class="hash-link" href="#d√©couverte-des-metadata-spring-batch" title="Direct link to heading">#</a></h3><p>Voici un extrait ci-dessous qui nous permettra de naviguer dans ce mod√®le technique :</p><table><thead><tr><th align="center"><img alt="ERD-Metadata" src="/docusaurus-test/assets/images/ERD_metadata-5163332f70087a920c422fd97befe87f.png"></th></tr></thead><tbody><tr><td align="center"><strong>Image Credits - <a href="https://docs.spring.io/spring-batch/docs/current/reference/html/index-single.html#metaDataSchema" target="_blank" rel="noopener noreferrer">Figure 35. Spring Batch Meta-Data ERD</a></strong></td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="batch_job_instance"></a>BATCH_JOB_INSTANCE<a class="hash-link" href="#batch_job_instance" title="Direct link to heading">#</a></h4><p>Il s&#x27;agit de la table principale du mod√®le de donn√©es.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> BATCH_JOB_INSTANCE</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th>JOB_INSTANCE_ID</th><th>VERSION</th><th>JOB_NAME</th><th>JOB_KEY</th></tr></thead><tbody><tr><td>1</td><td>0</td><td>myFirstJob</td><td>d41d8cd98f00b204e9800998ecf8427e</td></tr></tbody></table><p>La table nous indique qu&#x27;un batch nomm√© <em>myFirstJob</em> tourne, ou a tourn√©.</p><p>Nous noterons son <em>JOB_INSTANCE_ID</em> (1, il s&#x27;agit d&#x27;une base m√©moire, nous aurons toujours 1, n√©anmoins, si les metadata sont persit√©es, cet <em>id</em> sera incr√©ment√©).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="batch_job_execution"></a>BATCH_JOB_EXECUTION<a class="hash-link" href="#batch_job_execution" title="Direct link to heading">#</a></h4><p>Il s&#x27;agit de la table contenant les informations d&#x27;ex√©cution de <em>Job</em>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> BATCH_JOB_EXECUTION</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th>JOB_EXECUTION_ID</th><th>VERSION</th><th>JOB_INSTANCE_ID</th><th>CREATE_TIME</th><th>START_TIME</th><th>END_TIME</th><th>STATUS</th><th>EXIT_CODE</th><th>EXIT_MESSAGE</th><th>LAST_UPDATED</th><th>JOB_CONFIGURATION_LOCATION</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>1</td><td>2021-09-13 19:03:14.702</td><td>2021-09-13</td><td>01:03:14.88</td><td>null</td><td>STARTED</td><td>UNKNOWN</td><td>2021-09-13 01:03:14.881</td><td>null</td></tr></tbody></table><p>La table nous apprend que le <em>Job</em> li√© au <em>JOB_INSTANCE_ID</em> 1 est en train de tourn√©, que son statut de fin d&#x27;ex√©cution est ind√©fini (<em>STATUS</em> = null &amp;&amp; <em>EXIT_CODE</em> = <em>UNKNWON</em>, notre point d&#x27;arr√™t √† stopp√© temporairement l&#x27;ex√©cution du <em>Job</em>).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="batch_job_execution_params"></a>BATCH_JOB_EXECUTION_PARAMS<a class="hash-link" href="#batch_job_execution_params" title="Direct link to heading">#</a></h4><p>Il s&#x27;agit de la table contenant les param√®tres d&#x27;ex√©cution.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> BATCH_JOB_EXECUTION_PARAMS</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th>JOB_EXECUTION_ID</th><th>TYPE_CD</th><th>KEY_NAME</th><th>STRING_VAL</th><th>DATE_VAL</th><th>LONG_VAL</th><th>DOUBLE_VAL</th><th>IDENTIFYING</th></tr></thead></table><p>Il s&#x27;agit d&#x27;une table tr√®s importante, <em>Spring Batch</em> s&#x27;appuiera dessus pour le rerun d&#x27;un batch d√©j√† ex√©cut√©.</p><p>Le couple <em>KEY_NAME</em> et <em>STRING_VAL</em> fera office d&#x27;identifiant de batch si le boolean <em>IDENTIFYING</em> est √† true.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Nous verrons plus tard dans le tutoriel comment ajouter des param√®tres d&#x27;ex√©cution.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="batch_job_execution_context"></a>BATCH_JOB_EXECUTION_CONTEXT<a class="hash-link" href="#batch_job_execution_context" title="Direct link to heading">#</a></h4><p>Il s&#x27;agit de la table de contexte d&#x27;ex√©cution de Job.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> BATCH_JOB_EXECUTION_CONTEXT</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th>JOB_EXECUTION_ID</th><th>SHORT_CONTEXT</th><th>SERIALIZED_CONTEXT</th></tr></thead><tbody><tr><td>1</td><td>{&quot;@class&quot;:&quot;java.util.HashMap&quot;}</td><td>null</td></tr></tbody></table><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Nous verrons plus tard dans le tutoriel comment ajouter des param√®tres d&#x27;ex√©cution.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="batch_step_execution"></a>BATCH_STEP_EXECUTION<a class="hash-link" href="#batch_step_execution" title="Direct link to heading">#</a></h4><p>L&#x27;ensemble des <em>Step</em> lanc√©es par les jobs.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> BATCH_STEP_EXECUTION</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th>STEP_EXECUTION_ID</th><th>VERSION</th><th>STEP_NAME</th><th>JOB_EXECUTION_ID</th><th>START_TIME</th><th>END_TIME</th><th>STATUS</th><th>COMMIT_COUNT</th><th>READ_COUNT</th><th>FILTER_COUNT</th><th>WRITE_COUNT</th><th>READ_SKIP_COUNT</th><th>WRITE_SKIP_COUNT</th><th>PROCESS_SKIP_COUNT</th><th>ROLLBACK_COUNT</th><th>EXIT_CODE</th><th>EXIT_MESSAGE</th><th>LAST_UPDATED</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>myFirstStep</td><td>1</td><td>2021-09-13 19:03:14.926</td><td>null</td><td>STARTED</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>EXECUTING</td><td>2021-09-13 01:03:14.927</td><td></td></tr></tbody></table><p>La table nous indique qu&#x27;une <em>Step</em> li√© √† notre <em>Job</em> vu pr√©c√©dement (<em>JOB_EXECUTION_ID</em> = 1) nomm√©e <em>myFirstStep</em> est en train de tourner (<em>STATUS</em> = <em>STARTED</em>)</p><p>Cette <em>Step</em> n&#x27;a aucun compteur diff√©rent de 0.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Nous verrons plus tard dans le tutoriel comment utiliser les compteurs fournis par les <em>metadata</em> de <em>Spring Batch</em>.</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="batch_step_execution_context"></a>BATCH_STEP_EXECUTION_CONTEXT<a class="hash-link" href="#batch_step_execution_context" title="Direct link to heading">#</a></h4><p>Il s&#x27;agit de la table de context d&#x27;ex√©cution de <em>Step</em>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> BATCH_STEP_EXECUTION_CONTEXT</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th>STEP_EXECUTION_ID</th><th>SHORT_CONTEXT</th><th>SERIALIZED_CONTEXT</th></tr></thead><tbody><tr><td>1</td><td>{&quot;@class&quot;:&quot;java.util.HashMap&quot;,&quot;batch.taskletType&quot;:&quot;fr.goro.tutorial.spring.batch.firstbatch.tasklet.FirstTasklet&quot;,&quot;batch.stepType&quot;:&quot;org.springframework.batch.core.step.tasklet.TaskletStep&quot;}</td><td>null</td></tr></tbody></table><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Nous verrons plus tard dans le tutoriel comment utiliser les compteurs fournis par les <em>metadata</em> de <em>Spring Batch</em>.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="cas-dutilisation"></a>Cas d&#x27;utilisation<a class="hash-link" href="#cas-dutilisation" title="Direct link to heading">#</a></h3><p>Ce cas d&#x27;utilisation est relativement rare, il ne s&#x27;utilise qu&#x27;en cas de non utilisation de base de donn√©es annexes (pour stockage, ou r√©cup√©ration de donn√©es durant le batch), et de non stockage (√† minima pour historisation) des donn√©es relatives au ex√©cution de notre traitement.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration-dune-datasource"></a>Configuration d&#x27;une datasource<a class="hash-link" href="#configuration-dune-datasource" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="repr√©sentation"></a>Repr√©sentation<a class="hash-link" href="#repr√©sentation" title="Direct link to heading">#</a></h3><div class="mermaid">flowchart TB
  subgraph Traitement [&quot;JVM&quot;]
    direction LR
    subgraph TrtJava [&quot;&amp;nbsp;&quot;]
      TutorialSpringBatchApplication ==&gt;|1| JobLauncher
      subgraph SpringBatchContext [&quot;Spring Batch Application Context&quot;]
        subgraph JobContext [&quot;Job Context&quot;]
          Job -.- myFirstJob(myFirstJob)
          Job ==&gt;|2| StepContext
          subgraph StepContext [&quot;Step Context&quot;]
            direction TB
            Step -.- myFirstStep(myFirstStep)
            Step ==&gt;|3| Tasklet
            Tasklet -.- myFirstTasklet(myFirstTasklet)
          end
        end
        JobLauncher &lt;-.-&gt; JobRepository
        JobContext &lt;-.-&gt; JobRepository
        StepContext &lt;-.-&gt; JobRepository
      end
    end
  end
  JobLauncher --&gt; JobContext
  Start[&quot;Lanchement de l&#x27;application via Launcher ou Command Line&quot;] --&gt;|0| Traitement --&gt;|4| End[&quot;Fin de traitement&quot;]
  subgraph DataBase [&quot;&amp;nbsp;&quot;]
    direction BT
      id3[(H2 - File Database)]
  end
  JobRepository &lt;-.-&gt; id3
  myFirstTasklet &lt;-.-&gt; id3</div><p>Contrairement √† la configuration par d√©faut, ici, la base de donn√©es n&#x27;est plus en m√©moire.</p><p>Aussi, suite √† notre modification de <em>tasklet</em>, <em>myFirstTasklet</em> acc√®de (pas tr√®s proprement ^^) √† notre base de donn√©es.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="configuration-yaml"></a>Configuration YAML<a class="hash-link" href="#configuration-yaml" title="Direct link to heading">#</a></h3><p>Commen√ßons par la configuration de la base de donn√©es sp√©cifique √† <em>Spring Batch</em> :</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">application.yml</div><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">h2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">~/Documents/h2db/tutorialSpringBatchDb;INIT=CREATE TABLE IF NOT EXISTS info_traitement (message varchar)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driverClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> org.h2.Driver</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sa</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jpa</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">database-platform</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> org.hibernate.dialect.H2Dialect</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">h2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">console</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">inputFile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/chemin/vers/fichier_a_traiter.txt</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Notre base de donn√©es aura pour url une base de donn√©es H2 qui pointe vers un fichier local, que nous avons nomm√©e springMetadata, le username par d√©faut est sa, aucun password.</p><p>L&#x27;ensemble de la configuration apr√®s le <code>INIT</code> sert √† simuler la pr√©sence d&#x27;une info_traitement.</p><div class="mermaid">erDiagram
    INFO_TRAITEMENT {
        string message
   }</div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="configuration-java"></a>Configuration Java<a class="hash-link" href="#configuration-java" title="Direct link to heading">#</a></h3><p>NA/ üòÑ</p><p><em>Spring</em> se charge de la configuration du <code>@Bean</code> <em>datasource</em> tout seul, seules les informations pr√©sentent dans la variable de configuration <code>spring.datasource</code> du fichier <code>application.yml</code> seront n√©cessaires.</p><p>N√©anmoins, nous allons modifier notre <em>tasklet</em> pour lui faire √©crire en base, alors pr√©parons, le terrain :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * D√©finition de notre premi√®re {@link Tasklet} de lecture de fichier.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * </span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param directoryPath la {@link Resource} dont le path est issu du fichier de</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *                      configuration.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param datasource    la datasource utilis√©e.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @return notre premi√®re {@link Tasklet} configur√©e.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> Tasklet </span><span class="token function" style="color:#d73a49">myFirstTasklet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token function" style="color:#d73a49">Value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;${inputFile}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> final Resource directoryPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            final DataSource datasource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FirstTasklet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">directoryPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> datasource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="utilisation-dune-datasource-dans-la-configuration"></a>Utilisation d&#x27;une datasource dans la configuration<a class="hash-link" href="#utilisation-dune-datasource-dans-la-configuration" title="Direct link to heading">#</a></h3><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Attention</h5></div><div class="admonition-content"><p>Ce code source n&#x27;est qu&#x27;un exemple le plus simple pour visualiser en base de donn√©es le r√©sultat, il ne fait pas office de bon exemple.</p></div></div><p>Nous allons simplement ajouter un attribut <em>DataSource</em> et ins√©rer notre contenu dans la base de donn√©es :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Le fichier √† traiter.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> final Resource inputFile</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Datasource de traitement.</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> final DataSource datasource</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Constructeur param√©tr√© de MyFirstTasklet.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param inputFile  le fichier √† traiter.</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param datasource la datasource de traitement.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FirstTasklet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">final Resource inputFile</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> final DataSource datasource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">notNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Le fichier en entr√©e de la Tasklet ne peut √™tre vide !&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">inputFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> inputFile</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasource </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> datasource</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * M√©thode de traitement de {@link FirstTasklet}.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Cette m√©thode logguera puis stockera en base de donn√©es le contenu du fichier</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * pass√© en param√©tre.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> RepeatStatus </span><span class="token function" style="color:#d73a49">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final StepContribution contribution</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> final ChunkContext chunkContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> throws Exception </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Files</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lines</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputFile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">collect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Collectors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">joining</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">LOGGER</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Insertion en base de donn√©es.</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        final PreparedStatement prepareStatement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> datasource</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">prepareStatement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;insert into info_traitement (message) values (?)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        prepareStatement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        prepareStatement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">executeUpdate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> RepeatStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">FINISHED</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Rappel üòÑ Best Practice</h5></div><div class="admonition-content"><p>Ne jamais utiliser d&#x27;annotation dans une classe de traitement. Pour un batch <em>Spring</em>, les annotations ne seront accept√©es que dans la main class ou dans le package <code>config</code>.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="test-de-lapplication"></a>Test de l&#x27;application<a class="hash-link" href="#test-de-lapplication" title="Direct link to heading">#</a></h3><p>Avec cette configuration, si nous lan√ßons notre batch, nous retrouvons ces informations dans les logs :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span></span><span class="token-line" style="color:#393A34"><span class="token plain">w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 2791 ms</span></span><span class="token-line" style="color:#393A34"><span class="token plain">com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at &#x27;/h2-console&#x27;. Database available at &#x27;jdbc:h2:~/Documents/h2db/tutorialSpringBatchDb&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.c.r.s.JobRepositoryFactoryBean     : No database type set, using meta data indicating: H2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.c.l.support.SimpleJobLauncher      : No TaskExecutor has been set, defaulting to synchronous executor.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#x27;&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Remettons un point d&#x27;arr√™t dans la <em>Tasklet</em> et relan√ßons en mode <em>Debug</em>.</p><p>Oh ! Oh Oh Oh Oh ! ‚ö´</p><p>L&#x27;iDE ne s&#x27;est pas arr√©t√© dans le point d&#x27;arr√™t, regardons les logs...</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.a.b.JobLauncherApplicationRunner   : Running default command line with: [CommandLineJobRunner, fr.goro.tutorial.spring.batch.firstbatch.config.FirstBatchConfiguration, myFirstJob]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.c.l.support.SimpleJobLauncher      : Job: [SimpleJob: [name=myFirstJob]] launched with the following parameters: [{}]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.batch.core.job.SimpleStepHandler     : Step already complete or not restartable, so no action to execute: StepExecution: id=2, version=3, name=myFirstStep, status=COMPLETED, exitStatus=COMPLETED, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=1, rollbackCount=0, exitDescription=</span></span><span class="token-line" style="color:#393A34"><span class="token plain">o.s.b.c.l.support.SimpleJobLauncher      : Job: [SimpleJob: [name=myFirstJob]] completed with the following parameters: [{}] and the following status: [COMPLETED] in 52ms</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Attention</h5></div><div class="admonition-content"><p>Un <em>Job</em> lanc√© avec les m√™mes param√®tres (ici, aucun param√®tre) ne peut √™tre relanc√© que s&#x27;il n&#x27;est pas √† l&#x27;√©tat <em>COMPLETED</em> (notamment pour pouvoir relancer un batch <em>FAILED</em> apr√®s correction des entrants par exemple).</p><p>Il est possible de le faire sur une base de donn√©es embarqu√©e en m√©moire car celle-ci est recr√©√©e √† chaque lancement du batch.</p></div></div><p>Ici, nous travaillons sur une base de donn√©es en local, vous pouvez supprimer le fichier <em>db</em> cr√©√© au chemin d√©fini dans l&#x27;<code>application.yml</code>.</p><p>Pour parer ce comportement, et puisque nous ne nous interesserons pas √† au re-run dans cette partie du tutoriel, nous allons modifier le lancement de notre batch :</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Extrait de fr.goro.tutorial.spring.batch.firstbatch.config.FirstBatchConfiguration.java</div><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> Job </span><span class="token function" style="color:#d73a49">myFirstJob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">final JobBuilderFactory jobBuilderFactory</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> final Step myFirstStep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> jobBuilderFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;myFirstJob&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">incrementer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RunIdIncrementer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myFirstStep</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Nous utilisons ici un incr√©menteur d&#x27;identifiant de metadata, ce qui nous permettra de relancer le batch avec les m√™mes param√®tres.</p></div></div><p>Vous pouvez d√©sormais supprimer vos point d&#x27;arr√™t et relancer le batch autant de fois que vous voulez, il cr√©√©ra autant d&#x27;instance de <em>Job</em> en base de donn√©es.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="alternative-√†-la-console-h2"></a>Alternative √† la console H2<a class="hash-link" href="#alternative-√†-la-console-h2" title="Direct link to heading">#</a></h3><p>D√©sormais, nous avons un fichier <em>db</em> qui stocke notre base de donn√©es H2, il est facile de param√©trer une vue pour acc√®der graphiquement aux donn√©es.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="la-vue-database-development"></a>La vue Database Development<a class="hash-link" href="#la-vue-database-development" title="Direct link to heading">#</a></h4><p>Cette vue est disponible sur <em>Eclipse EE 2021-06</em>, elle peut √™tre install√©e via le MarketPlace sur d&#x27;autres versions : <code>Database Tools Platform (DTP) Plugin</code>. </p><table><thead><tr><th align="center"><strong><img alt="DbeaverData" src="/docusaurus-test/assets/images/dtp_config-2efe79ac198aa39ecbc88e7ddf24c26a.png"></strong></th></tr></thead><tbody><tr><td align="center"><strong>Database Tools Plateform - Configuration</strong></td></tr></tbody></table><table><thead><tr><th align="center"><strong><img alt="DbeaverData" src="/docusaurus-test/assets/images/dtp_viewdata-965af5f2fddd7057301a2eed2435cc15.png"></strong></th></tr></thead><tbody><tr><td align="center"><strong>Database Tools Plateform - View Data</strong></td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="la-vue-dbeaver"></a>La vue DBEaver<a class="hash-link" href="#la-vue-dbeaver" title="Direct link to heading">#</a></h4><p>DbEaver est un plugin disponible sur le MarketPlace.</p><table><thead><tr><th align="center"><strong><img alt="DbeaverData" src="/docusaurus-test/assets/images/dbeaver_config-26313623055d6caecc48affdf57630e1.png"></strong></th></tr></thead><tbody><tr><td align="center"><strong>DbEaver - Configuration</strong></td></tr></tbody></table><table><thead><tr><th align="center"><strong><img alt="DbeaverData" src="/docusaurus-test/assets/images/dbeaver_viewdata-eb65ef5cbd28457e68610fdb70793f11.png"></strong></th></tr></thead><tbody><tr><td align="center"><strong>DbEaver - View Data</strong></td></tr></tbody></table><p>Des deux, DBEaver est le seul √† proposer un ex√©cuteur de requ√™te, ce qui peut √™tre tr√®s utile.</p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</h5></div><div class="admonition-content"><p>Lorsque vous vous connectez √† la base de donn√©es via l&#x27;un de ces deux plugins, vous verrouillez la base de donn√©es. Pensez √† syst√©matiquement couper la connexion apr√®s avoir analys√© les donn√©es.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="cas-dutilisation-1"></a>Cas d&#x27;utilisation<a class="hash-link" href="#cas-dutilisation-1" title="Direct link to heading">#</a></h3><p>Ce cas d&#x27;utilisation est, selon moi, un cas standard lorsque </p><ul><li>l&#x27;on n&#x27;acc√®de √† aucune autre base de donn√©es <strong>OU</strong></li><li>l&#x27;on peut stocker les metadatas sur le sch√®ma par d√©faut (g√©n√©ralement <em>public</em>) de la base de donn√©es utilis√©es pour nos traitements.</li></ul><p>Dans le cas contraire (une base de donn√©es est utilis√©e, mais on ne peut pas y stocker nos metadata), il est possible de configurer d&#x27;autres datasource.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration-dune-seconde-datasource"></a>Configuration d&#x27;une seconde datasource<a class="hash-link" href="#configuration-dune-seconde-datasource" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="configuration-yaml-1"></a>Configuration YAML<a class="hash-link" href="#configuration-yaml-1" title="Direct link to heading">#</a></h3><p>Nous allons modifier l&#x27;<code>application.yml</code> comme ci-dessous :</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">&quot;application.yml</div><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">batch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">initialize-schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jdbcUrl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">h2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">~/Documents/h2db/tutorialSpringBatchMetadataDb</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> org.h2.Driver</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sa</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasourceTraitement</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jdbcUrl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">h2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">~/Documents/h2db/tutorialSpringBatchTraitementDb;INIT=CREATE TABLE IF NOT EXISTS info_traitement (message varchar)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> org.h2.Driver</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sa</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">inputFile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">~/Documents/test_tuto_batch/fichier_a_traiter.txt</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>La propri√©t√© <em>datasourceTraitement</em> est un nom d√©fini arbitrairement, essayer d&#x27;√™tre coh√©rent et parlant lors du nommage de celle-ci.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="configuration-java-1"></a>Configuration Java<a class="hash-link" href="#configuration-java-1" title="Direct link to heading">#</a></h3><p>La configuration d&#x27;une datasource via <em>Spring Boot</em> est grandement simplifi√©e, ainsi, voici la d√©finition de nos deux datasources :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> fr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">goro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tutorial</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">firstbatch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> javax</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataSource</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">springframework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">boot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ConfigurationProperties</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">springframework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">boot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EnableConfigurationProperties</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">springframework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">boot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jdbc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataSourceBuilder</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">springframework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Bean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">springframework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> org</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">springframework</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Primary</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Classe de configuration des datasources.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * </span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableConfigurationProperties</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DatasourcesConfiguration</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Cr√©ation de la datasource principale pour les metadata de Spring Batch.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * </span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @return la datasource principale.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Primary</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function" style="color:#d73a49">ConfigurationProperties</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;spring.datasource&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> DataSource </span><span class="token function" style="color:#d73a49">datasource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> DataSourceBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Cr√©ation de la seconde datasource pour les donn√©es de traitement.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * </span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @return la datasource secondaire.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function" style="color:#d73a49">ConfigurationProperties</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;spring.datasource-traitement&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> DataSource </span><span class="token function" style="color:#d73a49">secondDatasource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> DataSourceBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ul><li><p>Il est important de pr√©ciser √† <em>Spring Batch</em> une <code>@Primary</code> <em>datasource</em>, c&#x27;est celle qui sera utilis√© pour la cr√©ation des metadata.</p></li><li><p>Lors de l&#x27;utilisation de <em>@ConfigurationProperties</em> (activ√©e par <em>@EnableConfigurationProperties</em>), il est recommand√© d&#x27;ajouter cette d√©pendance au pom :</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-configuration-processor</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">optional</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">optional</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="utilisation-des-datasources"></a>Utilisation des datasources<a class="hash-link" href="#utilisation-des-datasources" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * D√©finition de notre premi√®re {@link Tasklet} de lecture de fichier.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * </span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param directoryPath la {@link Resource} dont le path est issu du fichier de</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     *                      configuration.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @param secondDatasource    la datasource utilis√©e.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @return notre premi√®re {@link Tasklet} configur√©e.</span></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> Tasklet </span><span class="token function" style="color:#d73a49">myFirstTasklet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token function" style="color:#d73a49">Value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;${inputFile}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> final Resource directoryPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            @</span><span class="token function" style="color:#d73a49">Qualifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;secondDatasource&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> final DataSource secondDatasource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FirstTasklet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">directoryPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secondDatasource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Il est, √† priori, indispensable d&#x27;utiliser un <code>@Qualifier</code> lorsqu&#x27;on utilise plusieurs datasources.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="test-de-lapplication-1"></a>Test de l&#x27;application<a class="hash-link" href="#test-de-lapplication-1" title="Direct link to heading">#</a></h3><table><thead><tr><th align="center"><strong><img alt="DbeaverData" src="/docusaurus-test/assets/images/h2_double_datasource-0d74bd8f0ac3e62db2d2419b0a178f06.png"></strong></th></tr></thead><tbody><tr><td align="center"><strong>DbEaver - View Data - Twice Datasources</strong></td></tr></tbody></table><p>Nous avons bien nos deux <em>datasources</em> attendues :</p><ul><li>tutorialSpringBatchMetadataDb contenant les <em>metadata</em> de <em>Spring Batch</em>,</li><li>tutorialSpringBatchTraitementDb contenant les donn√©es m√©tiers de notre traitement.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>Nous venons de voir qu&#x27;il est assez simple de configurer des bases de donn√©es avec l&#x27;auto configuration de <em>Spring</em>,
n√©anmoins, nous avons √©t√© incapable de relancer notre batch sans <code>IncrementerId</code>.</p><p>Afin de mieux comprendre ce point, nous allons nous pencher sur la table BATCH<em>JOB_PARAMETERS, et l&#x27;utilisation de param√®tre pass√© au _Job</em>.</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/GoroGoraK/docusaurus-test/docs/tutorial-basics/datasource.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docusaurus-test/docs/tutorial-basics/first-job"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Mon premier Job</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docusaurus-test/docs/tutorial-basics/jobparameter"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Param√®tres de Job ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objectif" class="table-of-contents__link">Objectif</a><ul><li><a href="#traitement-cible" class="table-of-contents__link">Traitement cible</a></li><li><a href="#structure-physique" class="table-of-contents__link">Structure Physique</a></li></ul></li><li><a href="#pr√©ambule" class="table-of-contents__link">Pr√©ambule</a></li><li><a href="#configuration-par-d√©faut-de-la-datasource-spring" class="table-of-contents__link">Configuration par d√©faut de la datasource Spring</a><ul><li><a href="#d√©couverte-de-la-console-h2" class="table-of-contents__link">D√©couverte de la console h2</a></li><li><a href="#d√©couverte-des-metadata-spring-batch" class="table-of-contents__link">D√©couverte des <em>Metadata</em> <em>Spring Batch</em></a></li><li><a href="#cas-dutilisation" class="table-of-contents__link">Cas d&#39;utilisation</a></li></ul></li><li><a href="#configuration-dune-datasource" class="table-of-contents__link">Configuration d&#39;une datasource</a><ul><li><a href="#repr√©sentation" class="table-of-contents__link">Repr√©sentation</a></li><li><a href="#configuration-yaml" class="table-of-contents__link">Configuration YAML</a></li><li><a href="#configuration-java" class="table-of-contents__link">Configuration Java</a></li><li><a href="#utilisation-dune-datasource-dans-la-configuration" class="table-of-contents__link">Utilisation d&#39;une datasource dans la configuration</a></li><li><a href="#test-de-lapplication" class="table-of-contents__link">Test de l&#39;application</a></li><li><a href="#alternative-√†-la-console-h2" class="table-of-contents__link">Alternative √† la console H2</a></li><li><a href="#cas-dutilisation-1" class="table-of-contents__link">Cas d&#39;utilisation</a></li></ul></li><li><a href="#configuration-dune-seconde-datasource" class="table-of-contents__link">Configuration d&#39;une seconde datasource</a><ul><li><a href="#configuration-yaml-1" class="table-of-contents__link">Configuration YAML</a></li><li><a href="#configuration-java-1" class="table-of-contents__link">Configuration Java</a></li><li><a href="#utilisation-des-datasources" class="table-of-contents__link">Utilisation des datasources</a></li><li><a href="#test-de-lapplication-1" class="table-of-contents__link">Test de l&#39;application</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Spring Batch</div><ul class="footer__items"><li class="footer__item"><a href="https://docs.spring.io/spring-batch/docs/current/reference/html/index-single.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Spring batch Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/GoroGoraK/docusaurus-test" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus-test/assets/js/runtime~main.08455da9.js"></script>
<script src="/docusaurus-test/assets/js/main.416363ce.js"></script>
</body>
</html>